/*! For license information please see field.js.LICENSE.txt */
(self.webpackChunkgabelbart_geolocation_field=self.webpackChunkgabelbart_geolocation_field||[]).push([[175],{7438:(e,t,n)=>{"use strict";var r=n(311),i={class:"flex items-center"},o={key:0},a={key:1};const l={props:{resourceName:{type:String,required:!0},field:{type:Object,required:!0}},computed:{fieldValue:function(){if(this.field.displayedAs)return this.field.displayedAs;var e=JSON.parse(this.field.value),t=e.latitude,n=e.longitude;return null!==t&&null!==n?"".concat(parseFloat(t).toFixed(6),", ").concat(parseFloat(n).toFixed(6)):null}}};var u=n(3744);const s=(0,u.Z)(l,[["render",function(e,t,n,l,u,s){var c=(0,r.resolveComponent)("Icon");return(0,r.openBlock)(),(0,r.createElementBlock)("span",i,[(0,r.createVNode)(c,{class:"mr-2",type:"globe-alt"}),s.fieldValue?((0,r.openBlock)(),(0,r.createElementBlock)("span",o,(0,r.toDisplayString)(s.fieldValue),1)):((0,r.openBlock)(),(0,r.createElementBlock)("span",a,"â€”"))])}]]);var c={class:"geolocation-detail-field__container"};var d=n(7713),f=function(){var e=(0,r.ref)(null),t=function(){e.value&&(e.value.disconnect(),e.value=null)};return{startObservingMapVisibility:function(n){t(),e.value=new IntersectionObserver((function(e){e.some((function(e){return void 0===e.isVisible&&(e.isVisible=!0),e.isIntersecting&&e.isVisible}))&&n.leafletObject&&n.leafletObject.invalidateSize()}),{delay:100,threshold:[0,1],trackVisibility:!0}),e.value.observe(n.$el)},endObservingMapVisibility:t}};function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===h(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const m={components:{LMap:d.iA,LMarker:d.$R,LTileLayer:d.Hw},props:{index:{type:[Number,String],required:!0},resource:{type:Object,required:!0},resourceName:{type:String,required:!0},resourceId:{type:String,required:!0},field:{type:Object,required:!0}},setup:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f())},data:function(){return{zoom:10,marker:null,value:null}},computed:{cHasValue:function(){return null!==this.value.latitude&&null!==this.value.longitude&&!isNaN(this.value.latitude)&&!isNaN(this.value.longitude)}},mounted:function(){this.value=JSON.parse(this.field.value),this.cHasValue&&this.setMarker(this.value.latitude,this.value.longitude),this.zoom=this.field.defaultZoom},beforeUnmount:function(){this.endObservingMapVisibility()},methods:{onMapReady:function(e){var t=this.cHasValue?[this.value.latitude,this.value.longitude]:[this.field.defaultLatitude,this.field.defaultLongitude];e.panTo(t),e.setZoom(this.field.defaultZoom),this.startObservingMapVisibility(this.$refs.map)},onUpdateCenter:function(){this.cHasValue&&this.padMapToMarker()},setMarker:function(e,t){this.marker=[e,t]},padMapToMarker:function(){this.$refs.map.leafletObject.panInside(this.marker,{paddingTopLeft:[25,50],paddingBottomRight:[25,25]})}}},y=(0,u.Z)(m,[["render",function(e,t,n,i,o,a){var l=(0,r.resolveComponent)("l-tile-layer"),u=(0,r.resolveComponent)("l-marker"),s=(0,r.resolveComponent)("l-map"),d=(0,r.resolveComponent)("PanelItem");return(0,r.openBlock)(),(0,r.createBlock)(d,{class:"geolocation-detail-field",field:n.field,index:n.index},{value:(0,r.withCtx)((function(){return[(0,r.createElementVNode)("div",c,[(0,r.createVNode)(s,{ref:"map",zoom:e.zoom,"onUpdate:zoom":t[0]||(t[0]=function(t){return e.zoom=t}),"max-zoom":18,"min-zoom":1,onReady:a.onMapReady,"onUpdate:center":a.onUpdateCenter},{default:(0,r.withCtx)((function(){return[(0,r.createVNode)(l,(0,r.normalizeProps)((0,r.guardReactiveProps)(n.field.tileLayer)),null,16),a.cHasValue?((0,r.openBlock)(),(0,r.createBlock)(u,{key:0,"lat-lng":e.marker},null,8,["lat-lng"])):(0,r.createCommentVNode)("",!0)]})),_:1},8,["zoom","onReady","onUpdate:center"])])]})),_:1},8,["field","index"])}]]);var g={class:"text-lg"},b={key:0,class:"my-2 text-danger"};var w=n(3906),O=n.n(w),N={preventInitialLoading:{type:Boolean,default:!1},showHelpText:{type:Boolean,default:!1},shownViaNewRelationModal:{type:Boolean,default:!1},resourceId:{type:[Number,String]},resourceName:{type:String},relatedResourceId:{type:[Number,String]},relatedResourceName:{type:String},field:{type:Object,required:!0},viaResource:{type:String,required:!1},viaResourceId:{type:[String,Number],required:!1},viaRelationship:{type:String,required:!1},relationshipType:{type:String,default:""},shouldOverrideMeta:{type:Boolean,default:!1},disablePagination:{type:Boolean,default:!1},clickAction:{type:String,default:"view",validator:function(e){return["edit","select","ignore","detail"].includes(e)}},mode:{type:String,default:"form",validator:function(e){return["form","modal","action-modal","action-fullscreen"].includes(e)}}};function F(e){return O()(N,e)}var S=n(9442),V=n(6649);function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==j(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===j(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}C(C({},(0,S.OI)(["allowLeavingForm","preventLeavingForm","triggerPushState","resetPushState"])),{},{updateFormStatus:function(){1==this.canLeaveForm&&this.triggerPushState(),this.preventLeavingForm()},handlePreventFormAbandonment:function(e,t){this.canLeaveForm?e():window.confirm(this.__("Do you really want to leave? You have unsaved changes."))?e():t()},handlePreventFormAbandonmentOnInertia:function(e){var t=this;this.handlePreventFormAbandonment((function(){t.handleProceedingToNextPage(),t.allowLeavingForm()}),(function(){V.rC.ignoreHistoryState=!0,e.preventDefault(),e.returnValue="",t.removeOnNavigationChangesEvent=V.rC.on("before",(function(e){t.removeOnNavigationChangesEvent(),t.handlePreventFormAbandonmentOnInertia(e)}))}))},handlePreventFormAbandonmentOnPopState:function(e){var t=this;e.stopImmediatePropagation(),e.stopPropagation(),this.handlePreventFormAbandonment((function(){t.handleProceedingToPreviousPage(),t.allowLeavingForm()}),(function(){t.triggerPushState()}))},handleProceedingToPreviousPage:function(){window.onpopstate=null,V.rC.ignoreHistoryState=!1,this.removeOnBeforeUnloadEvent(),this.canLeaveFormToPreviousPage||window.history.back()},handleProceedingToNextPage:function(){window.onpopstate=null,V.rC.ignoreHistoryState=!1,this.removeOnBeforeUnloadEvent()}}),C({},(0,S.Se)(["canLeaveForm","canLeaveFormToPreviousPage"]));function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==k(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===k(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Boolean,x(x({},(0,S.OI)(["allowLeavingModal","preventLeavingModal"])),{},{updateModalStatus:function(){this.preventLeavingModal()},handlePreventModalAbandonment:function(e,t){if(this.canLeaveModal)e();else{if(window.confirm(this.__("Do you really want to leave? You have unsaved changes.")))return this.allowLeavingModal(),void e();t()}}}),x({},(0,S.Se)(["canLeaveModal"]));var I=n(3950),A=n(6034),M=n.n(A),R=n(4442),D=n.n(R),B=n(851),T=n.n(B),q=n(2512),U=n.n(q),$=n(759),H=n.n($),z=n(5543),G=n.n(z),Z=n(6534),J=n.n(Z);function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==W(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===W(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==X(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===X(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const re={extends:{extends:{props:{formUniqueId:{type:String}},methods:{emitFieldValue:function(e,t){Nova.$emit("".concat(e,"-value"),t),!0===this.hasFormUniqueId&&Nova.$emit("".concat(this.formUniqueId,"-").concat(e,"-value"),t)},emitFieldValueChange:function(e,t){Nova.$emit("".concat(e,"-change"),t),!0===this.hasFormUniqueId&&Nova.$emit("".concat(this.formUniqueId,"-").concat(e,"-change"),t)},getFieldAttributeValueEventName:function(e){return!0===this.hasFormUniqueId?"".concat(this.formUniqueId,"-").concat(e,"-value"):"".concat(e,"-value")},getFieldAttributeChangeEventName:function(e){return!0===this.hasFormUniqueId?"".concat(this.formUniqueId,"-").concat(e,"-change"):"".concat(e,"-change")}},computed:{hasFormUniqueId:function(){return!G()(this.formUniqueId)&&""!==this.formUniqueId},fieldAttributeValueEventName:function(){return this.getFieldAttributeValueEventName(this.field.attribute)},fieldAttributeChangeEventName:function(){return this.getFieldAttributeChangeEventName(this.field.attribute)}}},props:Y(Y({},F(["shownViaNewRelationModal","field","viaResource","viaResourceId","viaRelationship","resourceName","showHelpText","mode"])),{},{formUniqueId:{type:String}}),data:function(){return{value:""}},created:function(){this.setInitialValue()},mounted:function(){this.field.fill=this.fill,Nova.$on(this.fieldAttributeValueEventName,this.listenToValueChanges)},beforeUnmount:function(){Nova.$off(this.fieldAttributeValueEventName,this.listenToValueChanges)},methods:{setInitialValue:function(){this.value=void 0!==this.field.value&&null!==this.field.value?this.field.value:""},fill:function(e){this.fillIfVisible(e,this.field.attribute,String(this.value))},fillIfVisible:function(e,t,n){this.isVisible&&e.append(t,n)},handleChange:function(e){this.value=e.target.value,this.field&&this.emitFieldValueChange(this.field.attribute,this.value)},listenToValueChanges:function(e){this.value=e}},computed:{currentField:function(){return this.field},fullWidthContent:function(){return this.currentField.fullWidth||this.field.fullWidth},placeholder:function(){return this.currentField.placeholder||this.field.name},isVisible:function(){return this.field.visible},isReadonly:function(){return Boolean(this.field.readonly||T()(this.field,"extraAttributes.readonly"))},isActionRequest:function(){return["action-fullscreen","action-modal"].includes(this.mode)}}},emits:["field-shown","field-hidden"],props:te(te({},F(["shownViaNewRelationModal","field","viaResource","viaResourceId","viaRelationship","resourceName","resourceId","relatedResourceName","relatedResourceId"])),{},{syncEndpoint:{type:String,required:!1}}),data:function(){return{dependentFieldDebouncer:null,canceller:null,watchedFields:{},watchedEvents:{},syncedField:null,pivot:!1,editMode:"create"}},created:function(){this.dependentFieldDebouncer=M()((function(e){return e()}),50)},mounted:function(){var e=this;""===this.relatedResourceName||G()(this.relatedResourceName)?""===this.resourceId||G()(this.resourceId)||(this.editMode="update"):(this.pivot=!0,""===this.relatedResourceId||G()(this.relatedResourceId)?this.editMode="attach":this.editMode="update-attached"),H()(this.dependsOn)||D()(this.dependsOn,(function(t,n){e.watchedEvents[n]=function(t){e.watchedFields[n]=t,e.dependentFieldDebouncer((function(){e.watchedFields[n]=t,e.syncField()}))},e.watchedFields[n]=t,Nova.$on(e.getFieldAttributeChangeEventName(n),e.watchedEvents[n])}))},beforeUnmount:function(){var e=this;null!==this.canceller&&this.canceller(),H()(this.watchedEvents)||D()(this.watchedEvents,(function(t,n){Nova.$off(e.getFieldAttributeChangeEventName(n),t)}))},methods:{setInitialValue:function(){this.value=void 0!==this.currentField.value&&null!==this.currentField.value?this.currentField.value:this.value},fillIfVisible:function(e,t,n){this.currentlyIsVisible&&e.append(t,n)},syncField:function(){var e=this;null!==this.canceller&&this.canceller(),Nova.request().patch(this.syncEndpoint||this.syncFieldEndpoint,this.dependentFieldValues,{params:J()({editing:!0,editMode:this.editMode,viaResource:this.viaResource,viaResourceId:this.viaResourceId,viaRelationship:this.viaRelationship,field:this.field.attribute,component:this.field.dependentComponentKey},U()),cancelToken:new I.CancelToken((function(t){e.canceller=t}))}).then((function(t){var n=e.currentlyIsVisible;e.syncedField=t.data,e.syncedField.visible!==n&&e.$emit(!0===e.syncedField.visible?"field-shown":"field-hidden",e.field.attribute),G()(e.syncedField.value)?e.syncedField.value=e.field.value:e.setInitialValue(),e.onSyncedField()})).catch((function(e){if(!(0,I.isCancel)(e))throw e}))},onSyncedField:function(){}},computed:{currentField:function(){return this.syncedField||this.field},currentlyIsVisible:function(){return this.currentField.visible},currentlyIsReadonly:function(){return null!==this.syncedField?Boolean(this.syncedField.readonly||T()(this.syncedField,"extraAttributes.readonly")):Boolean(this.field.readonly||T()(this.field,"extraAttributes.readonly"))},dependsOn:function(){return this.field.dependsOn||[]},currentFieldValues:function(){return ne({},this.field.attribute,this.value)},dependentFieldValues:function(){return te(te({},this.currentFieldValues),this.watchedFields)},encodedDependentFieldValues:function(){return btoa(JSON.stringify(this.dependentFieldValues).replace(/[^\0-~]/g,(function(e){return"\\u"+("000"+e.charCodeAt().toString(16)).slice(-4)})))},syncFieldEndpoint:function(){return"update-attached"===this.editMode?"/nova-api/".concat(this.resourceName,"/").concat(this.resourceId,"/update-pivot-fields/").concat(this.relatedResourceName,"/").concat(this.relatedResourceId):"attach"===this.editMode?"/nova-api/".concat(this.resourceName,"/").concat(this.resourceId,"/creation-pivot-fields/").concat(this.relatedResourceName):"update"===this.editMode?"/nova-api/".concat(this.resourceName,"/").concat(this.resourceId,"/update-fields"):"/nova-api/".concat(this.resourceName,"/creation-fields")}}};var ie=n(7257);n(7267);F(["resourceName"]);const oe={props:{errors:{default:function(){return new ie.D1}}},data:function(){return{errorClass:"form-input-border-error"}},computed:{errorClasses:function(){return this.hasError?[this.errorClass]:[]},fieldAttribute:function(){return this.field.attribute},validationKey:function(){return this.field.validationKey},hasError:function(){return this.errors.has(this.validationKey)},firstError:function(){if(this.hasError)return this.errors.first(this.validationKey)}}};n(2725);Boolean;n(1423);function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function le(){le=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function s(e,t,n,i){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),l=new V(i||[]);return r(a,"_invoke",{value:O(e,n,l)}),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var d={};function f(){}function h(){}function p(){}var v={};u(v,o,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(j([])));y&&y!==t&&n.call(y,o)&&(v=y);var g=p.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(r,o,a,l){var u=c(e[r],e,o);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==ae(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,l)}),(function(e){i("throw",e,a,l)})):t.resolve(d).then((function(e){s.value=e,a(s)}),(function(e){return i("throw",e,a,l)}))}l(u.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function O(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return P()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var l=N(a,n);if(l){if(l===d)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function N(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,N(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=c(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function V(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function j(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:void 0,done:!0}}return h.prototype=p,r(g,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:h,configurable:!0}),h.displayName=u(p,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,l,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(w.prototype),u(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new w(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),u(g,l,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,V.prototype={constructor:V,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function ue(e,t,n,r,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,i)}function se(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==ae(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ae(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var he=Object.seal(["streetField","streetNumberField","postalCodeField","cityField","countryField","regionField"]);const pe={components:{LMap:d.iA,LMarker:d.$R,LTileLayer:d.Hw},mixins:[re,oe],props:{resourceName:{type:String,required:!0},resourceId:{type:String,required:!0},field:{type:Object,required:!0}},setup:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f())},data:function(){return{bounds:null,zoom:10,currentValue:null,newValue:null,value:null,address:{},ignoreAddressChanges:!1,geocoding:{timeout:null,loading:!1,cache:{},result:[]}}},computed:{cGeocodingResults:function(){var e,t,n=this;return null!==(e=null===(t=this.geocoding.result)||void 0===t?void 0:t.filter((function(e){return!(n.cHasNewValue&&e.lat===n.newValue[0]&&e.lng===n.newValue[1]||!n.cHasNewValue&&n.cHasCurrentValue&&e.lat===n.value.latitude&&e.lng===n.value.longitude)})))&&void 0!==e?e:[]},cResource:function(){for(var e={},t=this.$parent;t.$parent&&!t.$data.fields;)t=t.$parent;if(t.$data.fields)for(var n=0,r=Object.values(t.$data.fields);n<r.length;n++){var i=r[n];e[i.attribute]=i.value}return e},cDebounce:function(){return Nova.config("debounce")},cHasRequiredAddressComponents:function(){var e=this,t=function(t){return!!e.address[t]};return t("street")&&t("city")&&t("country")},cSelectViaMove:function(){return!this.field.selectionMode||"move"===this.field.selectionMode},cSelectViaDbclick:function(){return this.field.selectionMode&&"dbclick"===this.field.selectionMode},cHasCurrentValue:function(){var e,t,n,r;return null!==(null===(e=this.value)||void 0===e?void 0:e.latitude)&&null!==(null===(t=this.value)||void 0===t?void 0:t.longitude)&&!isNaN(null===(n=this.value)||void 0===n?void 0:n.latitude)&&!isNaN(null===(r=this.value)||void 0===r?void 0:r.longitude)},cHasNewValue:function(){var e,t,n,r;return null!==(null===(e=this.newValue)||void 0===e?void 0:e[0])&&null!==(null===(t=this.newValue)||void 0===t?void 0:t[1])&&!isNaN(null===(n=this.newValue)||void 0===n?void 0:n[0])&&!isNaN(null===(r=this.newValue)||void 0===r?void 0:r[1])},cNewValueIsWithinBounds:function(){if(!this.newValue||!this.bounds)return!0;var e=this.newValue[0],t=this.newValue[1];return e>this.bounds._southWest.lat&&e<this.bounds._northEast.lat&&t>this.bounds._southWest.lng&&t<this.bounds._northEast.lng}},created:function(){this.registerFieldChangeListeners()},mounted:function(){this.value=JSON.parse(this.currentField.value),this.cHasCurrentValue&&(this.setCurrentValue(this.value.latitude,this.value.longitude),this.setNewValue(this.value.latitude,this.value.longitude)),this.zoom=this.field.defaultZoom},beforeUnmount:function(){this.endObservingMapVisibility()},methods:{onClickSelectAddress:function(e){this.setNewValue(e.lat,e.lng),this.emitNewValue(e.lat,e.lng),this.currentField.writeBackGeocodedAddress&&this.writeBackGeocodedAddress(e)},onUpdateBounds:function(e){this.bounds=e},registerFieldChangeListeners:function(){var e,t=this,n=se(he);try{var r=function(){var n=e.value;t.currentField[n]&&(Nova.$on(t.getFieldAttributeChangeEventName(t.currentField[n]),(function(e){return t.onChangeAddressProperty(n,e)})),t.onChangeAddressProperty(n,t.cResource[t.currentField[n]]))};for(n.s();!(e=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}Nova.$on(this.getFieldAttributeChangeEventName(this.currentField.latitudeField),(function(e){return t.onChangeLatitude(e)})),Nova.$on(this.getFieldAttributeChangeEventName(this.currentField.longitudeField),(function(e){return t.onChangeLongitude(e)}))},onChangeAddressProperty:function(e,t){switch(e){case"streetField":this.address.street=t;break;case"streetNumberField":this.address.street_number=t;break;case"postalCodeField":this.address.postal_code=t;break;case"cityField":this.address.city=t;break;case"countryField":this.address.country=t;break;case"regionField":this.address.region=t}!this.ignoreAddressChanges&&this.cHasRequiredAddressComponents&&this.currentField.enableGeocoding&&this.geocodeDebounced()},onChangeLatitude:function(e){this.setNewLatitude(e)},onChangeLongitude:function(e){this.setNewLongitude(e)},cancelDebouncedGeocoding:function(){this.geocoding.timeout&&clearTimeout(this.geocoding.timeout),this.geocoding.timeout=null},geocodeDebounced:function(){var e=this;this.cancelDebouncedGeocoding(),this.geocoding.timeout=setTimeout((function(){return e.geocode()}),this.cDebounce)},geocode:function(){var e,t=this;return(e=le().mark((function e(){var n,r,i;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.geocoding.loading=!0,n=JSON.parse(JSON.stringify(t.address)),r=JSON.stringify(n),t.geocoding.cache[r]){e.next=17;break}return e.prev=4,e.next=7,Nova.request().post("/nova-vendor/gabelbart/geolocation-field/geocode",t.address);case 7:i=e.sent,t.geocoding.cache[r]=i.data,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t.geocoding.cache[r]=[];case 14:return e.prev=14,t.geocoding.loading=!1,e.finish(14);case 17:return t.geocoding.result=t.geocoding.cache[r],e.abrupt("return",t.geocoding.result);case 19:case"end":return e.stop()}}),e,null,[[4,11,14,17]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ue(o,r,i,a,l,"next",e)}function l(e){ue(o,r,i,a,l,"throw",e)}a(void 0)}))})()},listenToValueChanges:function(e){this.setNewValue(e.latitude,e.longitude),this.panMapToNewValue()},onMapReady:function(e){var t=this,n=this.cHasCurrentValue?[this.value.latitude,this.value.longitude]:[this.currentField.defaultLatitude,this.currentField.defaultLongitude];e.panTo(n),e.addEventListener("move",(function(e){return t.onMoveMap(e.target.getCenter())})),e.addEventListener("dblclick",(function(e){return t.onDbclickMap(e)})),e.setZoom(this.currentField.defaultZoom),this.startObservingMapVisibility(this.$refs.map)},onMoveMap:function(e){this.cSelectViaMove&&(this.setNewValue(e.lat,e.lng),this.emitNewValue(e.lat,e.lng))},onDbclickMap:function(e){if(this.cSelectViaDbclick){var t=e.latlng;this.setNewValue(t.lat,t.lng),this.emitNewValue(t.lat,t.lng)}},panMapToNewValue:function(){this.cHasNewValue&&this.$refs.map.leafletObject.panTo(this.newValue)},setCurrentValue:function(e,t){this.currentValue=[e,t]},emitNewValue:function(e,t){Nova.$emit(this.getFieldAttributeValueEventName(this.currentField.latitudeField),e),Nova.$emit(this.getFieldAttributeValueEventName(this.currentField.longitudeField),t)},emitAddressComponent:function(e,t){var n=this.currentField[e];n&&Nova.$emit(this.getFieldAttributeValueEventName(n),t)},setNewValue:function(e,t){this.newValue=[e,t],this.cNewValueIsWithinBounds||this.panMapToNewValue()},setNewLatitude:function(e){var t,n;this.setNewValue(e,null!==(t=null===(n=this.newValue)||void 0===n?void 0:n[1])&&void 0!==t?t:this.defaultLongitude)},setNewLongitude:function(e){var t,n;this.setNewValue(null!==(t=null===(n=this.newValue)||void 0===n?void 0:n[0])&&void 0!==t?t:this.defaultLatitude,e)},setInitialValue:function(){this.value=this.currentField.value||""},fill:function(e){},writeBackGeocodedAddress:function(e){this.ignoreAddressChanges=!0;var t,n=se(e.address_components);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.types.includes("street_number"))this.address.street_number=r.long_name,this.emitAddressComponent("streetNumberField",r.long_name);else if(r.types.includes("route"))this.address.street=r.long_name,this.emitAddressComponent("streetField",r.long_name);else if(r.types.includes("locality"))this.address.city=r.long_name,this.emitAddressComponent("cityField",r.long_name);else if(r.types.includes("administrative_area_level_1"))this.address.region=r.long_name,this.emitAddressComponent("regionField",r.long_name);else if(r.types.includes("country")){var i=this.writeBackGeocodedCountryLongFormat?r.long_name:r.short_name;this.address.country=i,this.emitAddressComponent("countryField",i)}else r.types.includes("postal_code")&&(this.address.postal_code=r.long_name,this.emitAddressComponent("postalCodeField",r.long_name))}}catch(e){n.e(e)}finally{n.f()}this.ignoreAddressChanges=!1}}},ve=(0,u.Z)(pe,[["render",function(e,t,n,i,o,a){var l=(0,r.resolveComponent)("DefaultButton"),u=(0,r.resolveComponent)("Card"),s=(0,r.resolveComponent)("l-tile-layer"),c=(0,r.resolveComponent)("l-marker"),d=(0,r.resolveComponent)("l-map"),f=(0,r.resolveComponent)("DefaultField");return(0,r.openBlock)(),(0,r.createBlock)(f,{class:"geolocation-form-field",errors:e.errors,field:e.currentField,"full-width-content":"","show-help-text":e.showHelpText},{field:(0,r.withCtx)((function(){return[(0,r.createElementVNode)("div",null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.cGeocodingResults,(function(t){return(0,r.openBlock)(),(0,r.createBlock)(u,{key:t.place_id,class:"mb-2 px-3 py-2 flex justify-between items-center bg-gray-200 dark:bg-gray-700"},{default:(0,r.withCtx)((function(){return[(0,r.createElementVNode)("div",g,(0,r.toDisplayString)(t.formatted_address),1),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l,{onClick:(0,r.withModifiers)((function(e){return a.onClickSelectAddress(t)}),["stop","prevent"])},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(e.__("nova_geolocation_field.select_geocoded_address")),1)]})),_:2},1032,["onClick"])])]})),_:2},1024)})),128))]),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["geolocation-form-field__container",e.errorClasses])},[(0,r.createVNode)(d,{ref:"map",zoom:e.zoom,"onUpdate:zoom":t[0]||(t[0]=function(t){return e.zoom=t}),"max-zoom":18,"min-zoom":1,options:{doubleClickZoom:!1},onReady:a.onMapReady,"onUpdate:bounds":a.onUpdateBounds},{default:(0,r.withCtx)((function(){return[(0,r.createVNode)(s,(0,r.normalizeProps)((0,r.guardReactiveProps)(e.currentField.tileLayer)),null,16),a.cHasCurrentValue?((0,r.openBlock)(),(0,r.createBlock)(c,{key:0,"lat-lng":e.currentValue,options:{opacity:.5}},null,8,["lat-lng","options"])):(0,r.createCommentVNode)("",!0),a.cHasNewValue?((0,r.openBlock)(),(0,r.createBlock)(c,{key:1,"lat-lng":e.newValue},null,8,["lat-lng"])):(0,r.createCommentVNode)("",!0)]})),_:1},8,["zoom","onReady","onUpdate:bounds"])],2),e.hasError?((0,r.openBlock)(),(0,r.createElementBlock)("p",b,(0,r.toDisplayString)(e.firstError),1)):(0,r.createCommentVNode)("",!0)]})),_:1},8,["errors","field","show-help-text"])}]]);Nova.booting((function(e,t){e.component("IndexGeolocationField",s),e.component("DetailGeolocationField",y),e.component("FormGeolocationField",ve)}))},6381:()=>{},311:e=>{"use strict";e.exports=Vue},8859:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[546,626,898],(()=>(t(7438),t(6381),t(8163))));e.O()}]);